#library "sharekey"
#include "../../compiler/lib/zcommon.h"

str keys[2][26] = {
    {0},
    {"RedCard", "YellowCard", "BlueCard", "RedSkull", "YellowSkull", "BlueSkull", "KeyBlue", "KeyGreen", "KeyYellow", "ChexRedCard", "ChexYellowCard", "ChexBlueCard", "RedFlemKey", "YellowFlemKey", "BlueFlemKey", "KeyAxe", "KeyCastle", "KeyCave", "KeyDungeon", "KeyEmerald", "KeyFire", "KeyHorn", "KeyRusted", "KeySilver", "KeySteel", "KeySwamp"}
};

script "GetFoundKeys" ENTER
{
    if (GetCVar("SV_SharedKeys") == 1)
    {
        for (int i = 0; i < 26; i++)
        {
            if (keys[0][i] == 1)
            {
                GiveInventory(keys[1][i], 1);
            }
        }
    }
}

script "FoundKey" (int index)
{
    if (keys[0][index] == 0)
    {
        str key = keys[1][index];

        if (GetCVar("SV_SharedKeys") == 1)
        {
            PlaySound(0, "misc/k_pkup", CHAN_AUTO, 1.0, FALSE, ATTN_NONE);
            Log(s:"\cd", n:0, s:"\c- has found the \cf", s:key, s:"!");

            for (int i = 0; i < PlayerCount(); i++)
            {
                SetActivatorToPlayer(i);
                GiveInventory(key, 1);
            }
        }
        else
        {
            GiveInventory(key, 1);
        }
    }

    keys[0][index] = 1;
}